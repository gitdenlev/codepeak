import{r as R,m as b,n as D,p as P,q as M,s as z,x as J,y as B,z as V,A as x}from"./k_872zHB.js";function H(t,i){if(typeof t!="string")throw new TypeError("argument str must be a string");const n={},r=i||{},e=r.decode||K;let o=0;for(;o<t.length;){const s=t.indexOf("=",o);if(s===-1)break;let c=t.indexOf(";",o);if(c===-1)c=t.length;else if(c<s){o=t.lastIndexOf(";",s-1)+1;continue}const u=t.slice(o,s).trim();if(r!=null&&r.filter&&!(r!=null&&r.filter(u))){o=c+1;continue}if(n[u]===void 0){let a=t.slice(s+1,c).trim();a.codePointAt(0)===34&&(a=a.slice(1,-1)),n[u]=q(a,e)}o=c+1}return n}function K(t){return t.includes("%")?decodeURIComponent(t):t}function q(t,i){try{return i(t)}catch{return t}}const w=/^[\u0009\u0020-\u007E\u0080-\u00FF]+$/;function C(t,i,n){const r=n||{},e=r.encode||encodeURIComponent;if(typeof e!="function")throw new TypeError("option encode is invalid");if(!w.test(t))throw new TypeError("argument name is invalid");const o=e(i);if(o&&!w.test(o))throw new TypeError("argument val is invalid");let s=t+"="+o;if(r.maxAge!==void 0&&r.maxAge!==null){const c=r.maxAge-0;if(Number.isNaN(c)||!Number.isFinite(c))throw new TypeError("option maxAge is invalid");s+="; Max-Age="+Math.floor(c)}if(r.domain){if(!w.test(r.domain))throw new TypeError("option domain is invalid");s+="; Domain="+r.domain}if(r.path){if(!w.test(r.path))throw new TypeError("option path is invalid");s+="; Path="+r.path}if(r.expires){if(!X(r.expires)||Number.isNaN(r.expires.valueOf()))throw new TypeError("option expires is invalid");s+="; Expires="+r.expires.toUTCString()}if(r.httpOnly&&(s+="; HttpOnly"),r.secure&&(s+="; Secure"),r.priority)switch(typeof r.priority=="string"?r.priority.toLowerCase():r.priority){case"low":{s+="; Priority=Low";break}case"medium":{s+="; Priority=Medium";break}case"high":{s+="; Priority=High";break}default:throw new TypeError("option priority is invalid")}if(r.sameSite)switch(typeof r.sameSite=="string"?r.sameSite.toLowerCase():r.sameSite){case!0:{s+="; SameSite=Strict";break}case"lax":{s+="; SameSite=Lax";break}case"strict":{s+="; SameSite=Strict";break}case"none":{s+="; SameSite=None";break}default:throw new TypeError("option sameSite is invalid")}return r.partitioned&&(s+="; Partitioned"),s}function X(t){return Object.prototype.toString.call(t)==="[object Date]"||t instanceof Date}const E=Object.freeze({ignoreUnknown:!1,respectType:!1,respectFunctionNames:!1,respectFunctionProperties:!1,unorderedObjects:!0,unorderedArrays:!1,unorderedSets:!1,excludeKeys:void 0,excludeValues:void 0,replacer:void 0});function v(t,i){i?i={...E,...i}:i=E;const n=F(i);return n.dispatch(t),n.toString()}const Y=Object.freeze(["prototype","__proto__","constructor"]);function F(t){let i="",n=new Map;const r=e=>{i+=e};return{toString(){return i},getContext(){return n},dispatch(e){return t.replacer&&(e=t.replacer(e)),this[e===null?"null":typeof e](e)},object(e){if(e&&typeof e.toJSON=="function")return this.object(e.toJSON());const o=Object.prototype.toString.call(e);let s="";const c=o.length;c<10?s="unknown:["+o+"]":s=o.slice(8,c-1),s=s.toLowerCase();let u=null;if((u=n.get(e))===void 0)n.set(e,n.size);else return this.dispatch("[CIRCULAR:"+u+"]");if(typeof Buffer<"u"&&Buffer.isBuffer&&Buffer.isBuffer(e))return r("buffer:"),r(e.toString("utf8"));if(s!=="object"&&s!=="function"&&s!=="asyncfunction")this[s]?this[s](e):t.ignoreUnknown||this.unkown(e,s);else{let a=Object.keys(e);t.unorderedObjects&&(a=a.sort());let l=[];t.respectType!==!1&&!T(e)&&(l=Y),t.excludeKeys&&(a=a.filter(f=>!t.excludeKeys(f)),l=l.filter(f=>!t.excludeKeys(f))),r("object:"+(a.length+l.length)+":");const d=f=>{this.dispatch(f),r(":"),t.excludeValues||this.dispatch(e[f]),r(",")};for(const f of a)d(f);for(const f of l)d(f)}},array(e,o){if(o=o===void 0?t.unorderedArrays!==!1:o,r("array:"+e.length+":"),!o||e.length<=1){for(const u of e)this.dispatch(u);return}const s=new Map,c=e.map(u=>{const a=F(t);a.dispatch(u);for(const[l,d]of a.getContext())s.set(l,d);return a.toString()});return n=s,c.sort(),this.array(c,!1)},date(e){return r("date:"+e.toJSON())},symbol(e){return r("symbol:"+e.toString())},unkown(e,o){if(r(o),!!e&&(r(":"),e&&typeof e.entries=="function"))return this.array(Array.from(e.entries()),!0)},error(e){return r("error:"+e.toString())},boolean(e){return r("bool:"+e)},string(e){r("string:"+e.length+":"),r(e)},function(e){r("fn:"),T(e)?this.dispatch("[native]"):this.dispatch(e.toString()),t.respectFunctionNames!==!1&&this.dispatch("function-name:"+String(e.name)),t.respectFunctionProperties&&this.object(e)},number(e){return r("number:"+e)},xml(e){return r("xml:"+e.toString())},null(){return r("Null")},undefined(){return r("Undefined")},regexp(e){return r("regex:"+e.toString())},uint8array(e){return r("uint8array:"),this.dispatch(Array.prototype.slice.call(e))},uint8clampedarray(e){return r("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(e))},int8array(e){return r("int8array:"),this.dispatch(Array.prototype.slice.call(e))},uint16array(e){return r("uint16array:"),this.dispatch(Array.prototype.slice.call(e))},int16array(e){return r("int16array:"),this.dispatch(Array.prototype.slice.call(e))},uint32array(e){return r("uint32array:"),this.dispatch(Array.prototype.slice.call(e))},int32array(e){return r("int32array:"),this.dispatch(Array.prototype.slice.call(e))},float32array(e){return r("float32array:"),this.dispatch(Array.prototype.slice.call(e))},float64array(e){return r("float64array:"),this.dispatch(Array.prototype.slice.call(e))},arraybuffer(e){return r("arraybuffer:"),this.dispatch(new Uint8Array(e))},url(e){return r("url:"+e.toString())},map(e){r("map:");const o=[...e];return this.array(o,t.unorderedSets!==!1)},set(e){r("set:");const o=[...e];return this.array(o,t.unorderedSets!==!1)},file(e){return r("file:"),this.dispatch([e.name,e.size,e.type,e.lastModfied])},blob(){if(t.ignoreUnknown)return r("[blob]");throw new Error(`Hashing Blob objects is currently not supported
Use "options.replacer" or "options.ignoreUnknown"
`)},domwindow(){return r("domwindow")},bigint(e){return r("bigint:"+e.toString())},process(){return r("process")},timer(){return r("timer")},pipe(){return r("pipe")},tcp(){return r("tcp")},udp(){return r("udp")},tty(){return r("tty")},statwatcher(){return r("statwatcher")},securecontext(){return r("securecontext")},connection(){return r("connection")},zlib(){return r("zlib")},context(){return r("context")},nodescript(){return r("nodescript")},httpparser(){return r("httpparser")},dataview(){return r("dataview")},signal(){return r("signal")},fsevent(){return r("fsevent")},tlswrap(){return r("tlswrap")}}}const L="[native code] }",G=L.length;function T(t){return typeof t!="function"?!1:Function.prototype.toString.call(t).slice(-G)===L}function Q(t,i,n={}){return t===i||v(t,n)===v(i,n)}function ne(t,i,n={}){const r=A(t,n),e=A(i,n);return _(r,e,n)}function _(t,i,n={}){var o,s;const r=[],e=new Set([...Object.keys(t.props||{}),...Object.keys(i.props||{})]);if(t.props&&i.props)for(const c of e){const u=t.props[c],a=i.props[c];u&&a?r.push(..._((o=t.props)==null?void 0:o[c],(s=i.props)==null?void 0:s[c],n)):(u||a)&&r.push(new j((a||u).key,u?"removed":"added",a,u))}return e.size===0&&t.hash!==i.hash&&r.push(new j((i||t).key,"changed",i,t)),r}function A(t,i,n=""){if(t&&typeof t!="object")return new N(n,t,v(t,i));const r={},e=[];for(const o in t)r[o]=A(t[o],i,n?`${n}.${o}`:o),e.push(r[o].hash);return new N(n,t,`{${e.join(":")}}`,r)}class j{constructor(i,n,r,e){this.key=i,this.type=n,this.newValue=r,this.oldValue=e}toString(){return this.toJSON()}toJSON(){var i;switch(this.type){case"added":return`Added   \`${this.key}\``;case"removed":return`Removed \`${this.key}\``;case"changed":return`Changed \`${this.key}\` from \`${((i=this.oldValue)==null?void 0:i.toString())||"-"}\` to \`${this.newValue.toString()}\``}}}class N{constructor(i,n,r,e){this.key=i,this.value=n,this.hash=r,this.props=e}toString(){return this.props?`{${Object.keys(this.props).join(",")}}`:JSON.stringify(this.value)}toJSON(){const i=this.key||".";return this.props?`${i}({${Object.keys(this.props).join(",")}})`:`${i}(${this.value})`}}function p(t){if(typeof t!="object")return t;var i,n,r=Object.prototype.toString.call(t);if(r==="[object Object]"){if(t.constructor!==Object&&typeof t.constructor=="function"){n=new t.constructor;for(i in t)t.hasOwnProperty(i)&&n[i]!==t[i]&&(n[i]=p(t[i]))}else{n={};for(i in t)i==="__proto__"?Object.defineProperty(n,i,{value:p(t[i]),configurable:!0,enumerable:!0,writable:!0}):n[i]=p(t[i])}return n}if(r==="[object Array]"){for(i=t.length,n=Array(i);i--;)n[i]=p(t[i]);return n}return r==="[object Set]"?(n=new Set,t.forEach(function(e){n.add(p(e))}),n):r==="[object Map]"?(n=new Map,t.forEach(function(e,o){n.set(p(o),p(e))}),n):r==="[object Date]"?new Date(+t):r==="[object RegExp]"?(n=new RegExp(t.source,t.flags),n.lastIndex=t.lastIndex,n):r==="[object DataView]"?new t.constructor(p(t.buffer)):r==="[object ArrayBuffer]"?t.slice(0):r.slice(-6)==="Array]"?new t.constructor(t):t}const Z={path:"/",watch:!0,decode:t=>z(decodeURIComponent(t)),encode:t=>encodeURIComponent(typeof t=="string"?t:JSON.stringify(t))},m=window.cookieStore;function S(t,i){var u;const n={...Z,...i};n.filter??(n.filter=a=>a===t);const r=U(n)||{};let e;n.maxAge!==void 0?e=n.maxAge*1e3:n.expires&&(e=n.expires.getTime()-Date.now());const o=e!==void 0&&e<=0,s=p(o?void 0:r[t]??((u=n.default)==null?void 0:u.call(n))),c=e&&!o?te(s,e,n.watch&&n.watch!=="shallow"):R(s);{let a=null;try{!m&&typeof BroadcastChannel<"u"&&(a=new BroadcastChannel(`nuxt:cookies:${t}`))}catch{}const l=()=>{n.readonly||Q(c.value,r[t])||(ee(t,c.value,n),r[t]=p(c.value),a==null||a.postMessage({value:n.encode(c.value)}))},d=h=>{var g;const y=h.refresh?(g=U(n))==null?void 0:g[t]:n.decode(h.value);f=!0,c.value=y,r[t]=p(y),J(()=>{f=!1})};let f=!1;const O=!!P();if(O&&b(()=>{f=!0,l(),a==null||a.close()}),m){const h=y=>{const g=y.changed.find(k=>k.name===t),I=y.deleted.find(k=>k.name===t);g&&d({value:g.value}),I&&d({value:null})};m.addEventListener("change",h),O&&b(()=>m.removeEventListener("change",h))}else a&&(a.onmessage=({data:h})=>d(h));n.watch?D(c,()=>{f||l()},{deep:n.watch!=="shallow"}):l()}return c}function U(t={}){return H(document.cookie,t)}function W(t,i,n={}){return i==null?C(t,i,{...n,maxAge:-1}):C(t,i,n)}function ee(t,i,n={}){document.cookie=W(t,i,n)}const $=2147483647;function te(t,i,n){let r,e,o=0;const s=n?R(t):{value:t};return P()&&b(()=>{e==null||e(),clearTimeout(r)}),M((c,u)=>{n&&(e=D(s,u));function a(){o=0,clearTimeout(r);const l=i-o,d=l<$?l:$;r=setTimeout(()=>{if(o+=d,o<i)return a();s.value=void 0,u()},d)}return{get(){return c(),s.value},set(l){a(),s.value=l,u()}}})}const ie=()=>{const t=S("token"),i=B("user",()=>{const e=S("user");try{const o=e.value?JSON.parse(e.value):null;return console.log("User restored from cookie:",o),o}catch(o){return console.error("Failed to parse user cookie:",o),null}}),n=async e=>{try{const o=await $fetch("/api/login",{method:"POST",body:e});if(o.token){t.value=o.token,i.value=o.user;const s=S("user",{maxAge:60*60*24*7,path:"/",secure:!0});s.value=JSON.stringify(o.user),console.log("User saved to cookie:",s.value),await x("/")}}catch(o){throw console.error("Login error:",o),o}},r=async()=>{t.value=null,i.value=null;const e=S("user");e.value=null,await x("/login")};return{token:t,user:i,email:V(()=>{var e;return i.value?(e=i.value)==null?void 0:e.email:null}),login:n,logout:r}};export{S as a,ne as d,Q as i,ie as u};
